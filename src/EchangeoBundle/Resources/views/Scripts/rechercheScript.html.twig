<!-- /* =======================================================
 * Ensembles des fonction utile à la recherche de services
 * par Guiraud Maxime
 * =======================================================*/ -->
<!-- exemple de checkbox -->
<!-- <input type="checkbox" value="test"></input -->>
<script type="text/javascript">
	/*scripts de recherche*/
	function displaySousCategorie(event) {
		/*récupération de la catégorie choisie*/
		console.log("display sous categorie | numéro catégorie choisie :");
		var id = this.options[this.selectedIndex].value;
		console.log(id);
		/*création de l'url*/ 
		var url = "{{ path('getSousCategories',{ 'id': "idPlaceholder" , '_format': 'json'}) }}";
		url = url.replace("idPlaceholder", id);
		console.log("url :");
		console.log(url);
		/*fonction ajax*/
		$("#titre").empty();	
		$("#liste").empty();	
		$.ajax({
			url: url,
			type: "GET",
			dataType: "json",
			success: function(data){
				console.log('test get data');
				console.log(data);
				$('#select2').empty();
				$('#select2').append($("<form id='formSousCategorie' method='get'>"));
				for(var i=0; i<data.length; i++){
					$('#formSousCategorie').append($("<h4>").text(data[i].libelle).append($("<input type='checkbox' value="+data[i].id+"  onchange='displayServices()'>")));
					for(var j=0; j<data[i].services.length; j++){
						$('#titre').text("Annonces disponibles :")
						$('#liste').append($("<div>")
							.append($("<h3>").text(data[i].services[j].titre))
							.append($("<p>").text("Proposé par : "+data[i].services[j].inscrit.username))
							.append($("<a id="+data[i].services[j].id+" href='#' class='button_details'>").text('voir en détails'))
						);
					}
				}
			},
			error: function (req, status, err){
				console.log("erreur");
				console.log(err);
			}
		});

	}

	function displayServices(){
		console.log("activation displayServices");
		var selectedId = [];
		$('#formSousCategorie input:checked').each(function() {
    		selectedId.push($(this).attr('value'));
		});
		console.log('liste des sousCatégorie choisie(s) :');
		console.log(selectedId);
		/*création de l'url*/ 
		var url = "{{ path('getServicesSousCategories',{ 'id': "idPlaceholder" , '_format': 'json'}) }}";
		url = url.replace("idPlaceholder", selectedId);
		console.log("url :");
		console.log(url);
		/*AJAX*/
		/*$("#titre").empty();*/	
		$("#liste").empty();	
		$.ajax({
			url: url,
			type: "GET",
			dataType: "json",
			success: function(data){
				console.log('test rqt Ajax');
				console.log(data);
				for(var i=0; i<data.length; i++){
					$('#liste').append($("<div>")
						.append($("<h3>").text(data[i][0].titre))
						.append($("<p>").text("Proposé par : "+data[i][0].inscrit.username))
						.append($("<a id="+data[i][0].id+" href='#' class='button_details'>").text('voir en détails'))
					);
				}
			},
			error: function (req, status, err){
				console.log("erreur");
				console.log(err);
			}
		});
	}

	//Details des services
	$(document).ready(function(){
    	$('#liste a').click(function(){
        	var selectedId = $(this).attr("id");
        	console.log("Service n°: "+selectedId);  
        	/*création de l'url*/ 
			var url = "{{ path('getservicesID',{ 'id': "idPlaceholder" , '_format': 'json'}) }}";
			url = url.replace("idPlaceholder", selectedId);
			var urlForm = "{{ path('reponse_service') }}";
			console.log("url :");
			console.log(url);
			/*AJAX*/
			$("#titre").empty();	
			$("#liste").empty();	
			$.ajax({
				url: url,
				type: "GET",
				dataType: "json",
				success: function(data){
					console.log('test rqt Ajax');
					console.log(data);
					/*$('#titre').text("<- retour");*/
					$('#liste').append($("<div>")
						.append($("<h3>").text(data.titre))
						.append($("<p>").text("Proposé par : "+data.inscrit.username))
						.append($("<p>").text(""+data.description))
						.append($("<form action="+urlForm+" method='POST'>")
							.append($("<input type='hidden' name='idService' value="+data.id+">"))
							.append($("<input type='text' name='dateRDV' >"))
							.append($("<input type='text' name='message' placeholder='message'>"))
							.append($("<input type='submit' name='envoie' value='répondre'>"))
						)
					);
				},
				error: function (req, status, err){
					console.log("erreur");
					console.log(err);
				}
			});        
    	});
	});
</script>

