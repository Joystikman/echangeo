<!-- /* =======================================================
 * Ensembles des fonction utile à la gestion des reponses
 * par Guiraud Maxime
 * =======================================================*/ -->

 <script type="text/javascript">
	$(document).ready(function(){
		$("#reponsesMenu").css({'border-bottom': 'solid 12px #73B4D9'});
	});
/*on click service*/
	$(".tuile").on("click", function(){
		console.log('display');
		console.log(this.id);
		/*création de l'url*/ 
		var url = "{{ path('getreponseID',{ 'id': "idPlaceholder" , '_format': 'json'}) }}";
		url = url.replace("idPlaceholder", this.id);
		var urlForm = "{{ path('sendMessage') }}";
		urlForm = urlForm.replace("idPlaceholder", this.id);
		console.log(url);
		/*fonction ajax*/
		$("#cadre").empty();
		$("#cadre").append($("<img class='loading' src={{ asset('assets/Loading_icon.gif')}}>"));
		$.ajax({
			url: url,
			type: "GET",
			dataType: "json",
			success: function(data){
				console.log('test get data');
				console.log(data);
				$("#cadre").empty();
				$("#cadre").append($("<div id='service' class='service'>"));
				$("#service").append($("<div id='annonce' class='annonce'>"));
				$("#annonce").append($("<h2>").text(data.service.titre));
				$("#annonce").append($("<p>").text(data.service.description));
				$("#annonce").append($("<p>").text(data.service.debut+" - "+data.service.fin));
				$("#annonce").append($("<p>").text(data.service.lieu));
				$("#service").append($("<div id='reponse' class='reponse'>"));
				$("#reponse").append($("<h3>").text("Réponse :"));
				$("#reponse").append($("<h4>").text('de '+data.conversation.interlocuteur2.username));
				$("#reponse").append($("<p>").text('date proposé pour le service :'+data.date_rendez_vous));
				validation(data);
				$("#service").append($("<div id='conversation' class='conversation'>"));
				for(var i=0; i<data.conversation.messages.length; i++){
					var id = data.conversation.messages[i].id;
					$("#conversation").append($("<div id='message"+id+"' class='message'>"));
					$("#message"+id).append($("<h4>").text(data.conversation.messages[i].inscrit.username));
					$("#message"+id).append($("<p>").text(data.conversation.messages[i].contenu));
				}
				if (data.etat=="cloture") {
					$("#conversation").append($("<p>").text("Le service est cloture"))
				}
				else{
					$("#conversation").append($("<form id='send' action="+urlForm+" method='POST'>"));
					$("#send").append($("<input type='hidden' name='idConversation' value="+data.conversation.id+">"));
					$("#send").append($("<input type='hidden' name='page' value='reponse'>"));
					$("#send").append($("<input type='text' name='message' placeholder='message'>"));
					$("#send").append($("<input type='submit' name='envoie' value='répondre'>"));
				}
			}
		});
	}); 

	function validation(data){
		if (data.etat=="attente") {
			$("#reponse").append($("<div id='validation'>"));
			$("#validation").append($("<p>").text("votre proposition n'a pas encore été validé"));
		}
		if (data.etat=="valide"){
			$("#reponse").append($("<div id='validation'>"));
			$("#validation").append($("<p>").text("votre proposition a été validé. Un fois le service rendu, pensez à noter"));
		}
		if (data.etat=="notation"){
			var urlNote = "{{ path('notation') }}";
			$("#reponse").append($("<form id='validation' action="+urlNote+" method='POST'>"));
			$("#validation").append($("<input type='hidden' name='idReponse' value="+data.id+">"));
			$("#validation").append($("<input type='hidden' name='page' value='reponses'>"));
			$("#validation").append($("<label for='note'>Note : </label>"));
			$("#validation").append($("<input type='radio' name='note' value=1>"));
			$("#validation").append($("<input type='radio' name='note' value=2>"));
			$("#validation").append($("<input type='radio' name='note' value=3>"));
			$("#validation").append($("<input type='radio' name='note' value=4>"));
			$("#validation").append($("<input type='radio' name='note' value=5>"));
			$("#validation").append($("<input type='text' name='commentaire' placeholder='commentaire'>"));
			$("#validation").append($("<input type='submit' name='noter' value='noter'>"));
		}
		if (data.etat=="refuser"){
			$("#reponse").append($("<div>"));
			$("#reponse").append($("<p>").text("Votre proposition a été refusée. "));
		}
	}

</script>